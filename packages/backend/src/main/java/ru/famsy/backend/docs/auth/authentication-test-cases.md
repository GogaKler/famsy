# Тест-кейсы для системы аутентификации

## 1. Регистрация

### TC-R1: Успешная регистрация
**Предусловия:**
- Пользователь не авторизован
- Email не существует в системе

**Шаги:**
1. Отправить POST /auth/register
```json
{
  "email": "test@example.com",
  "username": "testuser",
  "password": "Password123"
}
```

**Ожидаемый результат:**
- Status: 200 OK
- Cookies установлены: access_token, refresh_token
- Response содержит UserDTO
- В БД создана запись пользователя и сессии

### TC-R2: Валидация email
**Шаги:**
1. Отправить запрос с невалидным email:
```json
{
"email": "invalid.email",
"username": "testuser",
"password": "Password123"
}
```

**Ожидаемый результат:**
- Status: 400 Bad Request
- Сообщение об ошибке валидации

### TC-R3: Дублирование данных
**Предусловия:**
- Существует пользователь с email "existing@example.com"

**Шаги:**
1. Попытаться зарегистрироваться с тем же email

**Ожидаемый результат:**
- Status: 400 Bad Request
- Сообщение о существующем email

## 2. Аутентификация

### TC-A1: Успешный вход
**Предусловия:**
- Существует пользователь

**Шаги:**
1. Отправить POST /auth/login
```json
{
  "login": "test@example.com",
  "password": "Password123"
}
```

**Ожидаемый результат:**
- Status: 200 OK
- Cookies установлены
- Response содержит UserDTO

### TC-A2: Вход с нового устройства
**Предусловия:**
- У пользователя есть 4 активные сессии

**Шаги:**
1. Войти с нового устройства

**Ожидаемый результат:**
- Успешный вход
- Самая старая сессия удалена

### TC-A3: Неверные credentials
**Шаги:**
1. Войти с неверным паролем

**Ожидаемый результат:**
- Status: 401 Unauthorized
- Сообщение о неверных credentials

## 3. Обновление токенов

### TC-T1: Успешное обновление
**Предусловия:**
- Пользователь авторизован
- Access token истек

**Шаги:**
1. Отправить запрос к защищенному endpoint

**Ожидаемый результат:**
- Новые токены установлены
- Запрос выполнен успешно

### TC-T2: Невалидный refresh token
**Шаги:**
1. Отправить запрос с измененным refresh token

**Ожидаемый результат:**
- Status: 401 Unauthorized
- Cookies очищены

## 4. Выход

### TC-L1: Успешный выход
**Предусловия:**
- Пользователь авторизован

**Шаги:**
1. Отправить POST /auth/logout

**Ожидаемый результат:**
- Status: 200 OK
- Cookies очищены
- Сессия удалена из БД

### TC-L2: Выход со всех устройств
**Предусловия:**
- Есть несколько активных сессий

**Шаги:**
1. Отправить POST /auth/logout-all

**Ожидаемый результат:**
- Все сессии удалены
- Cookies очищены

## 5. Граничные случаи

### TC-E1: Параллельные запросы
**Шаги:**
1. Отправить несколько параллельных запросов на обновление токенов

**Ожидаемый результат:**
- Только один запрос успешен
- Остальные получают ошибку

### TC-E2: Достижение лимитов
**Шаги:**
1. Создать максимальное количество сессий
2. Попытаться создать ещё одну

**Ожидаемый результат:**
- Самая старая сессия удалена
- Новая сессия создана